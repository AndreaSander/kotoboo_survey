---
title: "Kotoboo_data_viz"
author: "ASM"
date: "04/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(broom)
library(janitor)
library(readxl)
library(stringr)

```


Read in data
```{r}
x_2022_september_qualtrics_data <- read_excel("2022_september_qualtrics_data.xlsx", col_names=c("start_date", "end_date", "response_type", "progress", "duration_s", "finished", "recorded_date", "response_id","distribution_channel", "user_language", "recaptcha_score","consent", "year_birth", "gender","country", "not_caregiver", "is_parent","is_teacher","is_grandparent", "is_babysitter","is_aunt_uncle","is_sibling","is_therapist", "is_neighbour","is_family_friend", "is_other","visit_kotoboo", "how_helpful_evidence_based", "how_often_internet","which_topics_bilingualism","which_topics_screen_time","which_topics_lang_diversity","which_topics_sign_langauge","which_topics_foster_language","which_topics_reading_writing","which_topics_langauge_dev_disorders","which_topics_mythbusters","importance_concrete_advice", "importance_free","importance_easy_to_access", "importance_understandable", "importance_engaging","importance_EDI", "importance_social_media", "importance_reliable","importance_evidence_based", "importance_unpretentious", "importance_respectful","importance_fun", "importance_unbiased", "importance_other","importance_other_text", "participate_in_science", "comic_ideas", "comic_ideas_text", "sc0_score", "language", "q_language"))

x_2022_september_qualtrics_data<- x_2022_september_qualtrics_data [-c(1,2,3,4),]
```


Exclude data
```{r}
#203
x_2022_september_qualtrics_data<- x_2022_september_qualtrics_data %>%
  filter(year_birth <=2004) %>% #164 39 excluded
  filter(year_birth >=1922) %>% #2 more excluded
  filter(recaptcha_score >=.80) %>% #1 more excluded
  filter(consent=="I consent") #1 more excluded

#completion range

range(as.numeric(x_2022_september_qualtrics_data$progress)) #31-100 completed
```
##completion rate stats
```{r}
average_pop <- x_2022_september_qualtrics_data %>%
  select(progress)%>%
  filter(progress!="100") 
#average progress
mean(as.numeric(average_pop$progress))

table(average_pop$progress)

#average time spent in survey (take median as the better measure)
mean(as.numeric(x_2022_september_qualtrics_data$duration_s))
median(as.numeric(x_2022_september_qualtrics_data$duration_s))
table(x_2022_september_qualtrics_data$duration_s)
```


Get demographic info
```{r}


#Age range
x_2022_september_qualtrics_data <- x_2022_september_qualtrics_data %>%
  mutate(survey_year = 2022) %>%
  mutate(age = survey_year - as.numeric(year_birth))

range(x_2022_september_qualtrics_data$age) #19-63 years
mean(x_2022_september_qualtrics_data$age) #35.64 years

#Gender
sum(x_2022_september_qualtrics_data$gender=="Female", na.rm = T) #126 female
sum(x_2022_september_qualtrics_data$gender=="Male", na.rm = T)  # 31 male
sum(x_2022_september_qualtrics_data$gender=="Prefer not to answer", na.rm = T) #4 
#NA = 1


```


3. By country info
```{r}

country_table<- as.data.frame(table(x_2022_september_qualtrics_data$country))
print(country_table)

#I will make a png map with this info
```


4. Caregiver info
```{r}
#A. Percentage of caregivers
careg<- x_2022_september_qualtrics_data %>%
  select(c(not_caregiver, is_parent, is_teacher, is_grandparent, is_babysitter, is_aunt_uncle,
           is_sibling, is_therapist, is_neighbour, is_family_friend, is_other))  %>%
  mutate(not_caregiver = case_when(not_caregiver == "I am not a caregiver" ~ "T",
                                   TRUE~"F")) %>%
    mutate(is_parent = case_when(is_parent == "Parent" ~ "T",
                                   TRUE~"F")) %>%
    mutate(is_teacher = case_when(is_teacher == "Teacher/Educator" ~ "T",
                                   TRUE~"F")) %>%
      mutate(is_grandparent = case_when(is_grandparent == "Grandparent" ~ "T",
                                   TRUE~"F")) %>%
        mutate(is_babysitter = case_when(is_babysitter == "Nanny/Babysitter" ~ "T",
                                   TRUE~"F")) %>%
        mutate(is_aunt_uncle = case_when(is_aunt_uncle == "Uncle/Aunt" ~ "T",
                                   TRUE~"F"))%>%
        mutate(is_sibling = case_when(is_sibling == "Sibling" ~ "T",
                                   TRUE~"F")) %>%
        mutate(is_therapist = case_when(is_therapist == "Therapist" ~ "T",
                                   TRUE~"F")) %>%
        mutate(is_neighbour = case_when(is_neighbour == "Neighbour" ~ "T",
                                   TRUE~"F")) %>%
        mutate(is_family_friend = case_when(is_family_friend == "Family friend" ~ "T",
                                   TRUE~"F")) %>%
          mutate(is_other = case_when(is_other == "Other" ~ "T",
                                   TRUE~"F")) %>%
  count(not_caregiver, is_parent, is_teacher, is_grandparent, is_babysitter, is_aunt_uncle,
           is_sibling, is_therapist, is_neighbour, is_family_friend, is_other, sort=T)



only_parents <- careg %>%
  select(is_parent, n) %>%
  filter (is_parent == "T") 

sum(only_parents$n)
```

5. Kotoboo visits
```{r}
visits<- x_2022_september_qualtrics_data %>%
  select(visit_kotoboo)

visits_table<- as.data.frame(table(visits$visit_kotoboo)) 

visits_table<- visits_table %>%
  mutate(percentage = (Freq/160)*100)
```


6. Evidence based information
```{r}
#I have made 3 types of graphs so you can pick whatever suits better the poster
evidence <- x_2022_september_qualtrics_data %>%
  select(how_helpful_evidence_based)

evidence_table<- as.data.frame(table(evidence$how_helpful_evidence_based)) 

evidence_table <- evidence_table %>%
  mutate(percentage = (Freq/144)*100) %>%
  mutate(percentage = round(percentage, digits=0)) %>%
  mutate(helpfulness_level = Var1)



evi_plot <- ggplot(evidence_table, aes(x="", y=percentage, fill=helpfulness_level))+
geom_bar(width = 1, stat = "identity") +
  geom_text(aes(label = paste0(percentage, "%")),
            position = position_stack(vjust = 0.5))+
  labs(y="percentage evidence based helpfulness", x="")+  
  scale_fill_manual(values=c("#a7eb96",
"#c9b2daff",
"#ff9bb4"))+
  theme_bw()

evi_plot

#Run this code only if you want to get the pie chart

evi_pie<- evi_plot + coord_polar("y", start=0) + theme_void()

evi_pie

# Run this code for side by side bars, probably we need to change the scale for y though!
evi_plot_col <- ggplot(evidence_table, aes(x=helpfulness_level, y=percentage, fill=helpfulness_level))+
geom_col() +
  labs(y="percentage evidence based helpfulness", x="")+
  geom_text(aes(label = paste0(percentage, "%")),
            position = position_stack(vjust = 0.5))+
  labs(y="percentage evidence based helpfulness", x="")+  
  scale_fill_manual(values=c("#a7eb96",
"#c9b2daff",
"#ff9bb4"))+
  theme_bw()

evi_plot_col

```
7. Internet search frequency

```{r}

internet <- x_2022_september_qualtrics_data %>%
  select(how_often_internet)

internet_table<- as.data.frame(table(internet$how_often_internet)) 

internet_table <- internet_table %>%
  mutate(percentage = (Freq/142)*100) %>%
    mutate(percentage = round(percentage, digits=0)) %>%
  mutate(internet_search_frequency = Var1)

internet_plot <- ggplot(internet_table, aes(x="", y=percentage, fill=internet_search_frequency))+
geom_bar(width = 1, stat = "identity") +
  geom_text(aes(label = paste0(percentage, "%")),
            position = position_stack(vjust = 0.5))+
  labs(y="percentage internet search freq", x="")+
  scale_fill_manual(values=c("#a7eb96",
"#c9b2daff",
"#ff9bb4",
"#ffc297",
"#f0aae5ff",
"#fff3b6",
"#a7ffd3ff",
"#a4d5eb"))+
  theme_bw()

internet_plot

#Run this code only if you want to get the pie chart

internet_pie<- internet_plot + coord_polar("y", start=0) + theme_void()

internet_pie


```



8. Calculate the mean importance of each topic
```{r}
mean_importance <- x_2022_september_qualtrics_data %>%
  select(c("importance_concrete_advice", "importance_free","importance_easy_to_access", "importance_understandable", "importance_engaging","importance_EDI", "importance_social_media", "importance_reliable","importance_evidence_based", "importance_unpretentious", "importance_respectful","importance_fun", "importance_unbiased", "importance_other"))%>%
  pivot_longer(cols=c("importance_concrete_advice", "importance_free","importance_easy_to_access", "importance_understandable", "importance_engaging","importance_EDI", "importance_social_media", "importance_reliable","importance_evidence_based", "importance_unpretentious", "importance_respectful","importance_fun", "importance_unbiased", "importance_other"),names_to = "characteristic", values_to= "rating")%>%
  group_by(characteristic)%>% 
  mutate(rating = as.numeric(as.character(rating)))

mean_importance <- mean_importance %>%
  mutate(characteristic = case_when(characteristic == "importance_concrete_advice" ~ "gives concrete advice",
                                    characteristic == "importance_free" ~ "the content is free",
                                    characteristic == "importance_easy_to_access" ~ "it's easy to access",
                                    characteristic == "importance_understandable" ~ "content is understandable",
                                    characteristic == "importance_engaging" ~ "content is engaging",
                                    characteristic == "importance_EDI" ~ "fosters equity, diversity and inclusion",
                                    characteristic == "importance_social_media" ~ "shareable in social media",
                                    characteristic == "importance_reliable" ~ "the information is reliable",
                                    characteristic == "importance_evidence_based" ~ "the content is evidence based",
                                    characteristic == "importance_unpretentious" ~ "the content is unpretentious",
                                    characteristic == "importance_respectful" ~ "the content is respectful",
                                    characteristic == "importance_fun" ~ "the content is fun",
                                    characteristic == "importance_unbiased" ~ "the content is unbiased",
                                    characteristic == "importance_other" ~ "other reason not listed"))


plot<- mean_importance %>%
  ungroup()%>%
  group_by(characteristic)%>%
  summarise(mean = mean(rating, na.rm=T))

plot<- plot %>%
  mutate(characteristic = fct_reorder(plot$characteristic, plot$mean, .desc = T))
 
ggplot(plot, aes(y=characteristic, x=mean)) +
  geom_point(size=5)+
  theme_bw() +
  labs(x="Importance Ranking 1-14", y="Feature")+
  xlim(1, 14) + 
  annotate("text", y=1, x=3, label="most important <-", color="red") +
  annotate("text", y=1, x=10, label="least important ->", color ="red")
  




 
```



9. calculate the proportion of topics considered to be most interesting by parents. 
```{r}
by_topic <- x_2022_september_qualtrics_data %>%
  select(which_topics_interest)%>%
  drop_na() %>%
mutate ("language learning in bilingual and multilingual contexts" = case_when(str_detect(which_topics_interest,"Language learning in bilingual and multilingual contexts") ~ "1", TRUE ~ "0")) %>%
 mutate ("the effect of screen time on language learning" = case_when(str_detect(which_topics_interest,"The effects of screen time on language learning") ~ "1", TRUE ~ "0")) %>%
   mutate ("language diversity (differences and similarities of languages across the world)" = case_when(str_detect(which_topics_interest,"Language diversity") ~ "1", TRUE ~ "0")) %>%
    mutate ("learning sign languages" = case_when(str_detect(which_topics_interest,"Learning sign languages") ~ "1", TRUE ~ "0")) %>%
    mutate ("ways to foster language learning" = case_when(str_detect(which_topics_interest,"Ways to foster language learning") ~ "1", TRUE ~ "0")) %>%
    mutate ("ways to develop reading/writing abilities" = case_when(str_detect(which_topics_interest,"Ways to develop reading") ~ "1", TRUE ~ "0")) %>%
     mutate ("ways to foster language learning in children with developmental disorders" = case_when(str_detect(which_topics_interest,"Ways to foster language learning in children with developmental disorders") ~ "1", TRUE ~ "0")) %>%
   mutate ("debunking commonly believed myths" = case_when(str_detect(which_topics_interest,"Debunking commonly believed myths") ~ "1", TRUE ~ "0")) %>%
  pivot_longer(cols = c("debunking commonly believed myths", 
                        "ways to foster language learning in children with developmental disorders",
                        "ways to develop reading/writing abilities",
                        "ways to foster language learning",
                        "learning sign languages",
                        "language diversity (differences and similarities of languages across the world)",
                       "the effect of screen time on language learning",
                       "language learning in bilingual and multilingual contexts"), 
               names_to = "topic", values_to = "n") %>%
  filter(n == "1") %>%
    select(topic) %>%
  group_by(topic) %>%
  tally() %>%
  mutate(percentage = (n/sum(n))*100) %>%
  mutate(percentage = round(percentage, digits=0))

by_topic <- by_topic %>%
   mutate(topic = fct_reorder(topic, percentage, .desc = TRUE))
 

bp<- ggplot(by_topic, aes(x="", y=percentage, fill=topic))+
geom_bar(width = 1, stat = "identity") + 
scale_fill_manual(values =c("#a7eb96",
"#c9b2daff",
"#ff9bb4",
"#ffc297",
"#f0aae5ff",
"#fff3b6",
"#a7ffd3ff",
"#a4d5eb"))+
    geom_text(aes(label = paste0(percentage, "%")),
            position = position_stack(vjust = 0.5))+
  labs(y="percentage votes", x="")+
  theme_bw()

bp
 

#Run this code only if you want to get the pie chart

pie<- bp + coord_polar("y", start=0) + theme_void()

pie
```


10. Do comics make you want to participate in studies?

```{r}
particip<- x_2022_june_qualtrics_data %>%
  select(participate_in_science) 

particip_table<- as.data.frame(table(particip$participate_in_science)) 

particip_table<- particip_table %>%
  mutate(percentage = (Freq/123)*100)%>%
  mutate (percentage = round(percentage, digits=0))%>%
  mutate("participate_in_science" = Var1)

careg_plot <- ggplot(particip_table, aes(x="", y=percentage, fill=`participate_in_science`))+
geom_bar(width = 1, stat = "identity") + geom_text(aes(label = paste0(percentage, "%")),
            position = position_stack(vjust = 0.5))+
  labs(y="percentage of votes", x="")+
  scale_fill_manual(values=c("#a7eb96",
"#c9b2daff",
"#ff9bb4",
"#ffc297"))+
  theme_bw()

careg_plot

careg_pie<- careg_plot + coord_polar("y", start=0) + theme_void()

careg_pie
```


############### STATISTICS ###############

1.linear regressions

```{r}
#First we will need dummy variables and to make internet use into a binary variable (yes or no).
library(fastDummies)

lm1<- x_2022_june_qualtrics_data %>%
  mutate(internet_usage = case_when(str_detect(how_often_internet, "Frequently") ~1,
                                    str_detect(how_often_internet, "Often")~1,
                                    str_detect(how_often_internet, "Occasionally")~1,
                                    TRUE~0)) %>%
  mutate(continent = case_when(country == "Australia" ~"Oceania",
                               country %in% c("Belarus","Denmark","France","Germany","Ireland","Portugal","Russian Federation","Sweden", "United Kingdom of Great Britain and Northen Ireland") ~ "Europe",
                               country %in% c("Brazil","Canada","Chile","Colombia","Mexico","Panama","Peru","United States of America")~"America",
                               country %in% c("China","Hong Kong (S.A.R.)","Japan","Singapore") ~ "Asia",
                               TRUE~"Not specified")) %>%
dummy_cols(select_columns = "gender", ignore_na = T) %>%
  dummy_cols(select_columns = "continent", ignore_na = T)=
lm1<- clean_names(lm1) %>%
  filter(!is.na(gender)) %>%
  filter(!is.na(continent))

#boxplots to visually demonstrate changes by gender and continent
ggplot(lm1, aes(x=gender, y=internet_usage))+
  geom_boxplot(na.rm=T)

ggplot(lm1, aes(x=continent, y=internet_usage))+
  geom_boxplot(na.rm=T)


#Does not converge when adding multiple genders. Being female does not explain variance
i1<- glm(internet_usage~ gender_female, data=lm1, family="binomial")
i1m <- glm(internet_usage~ gender_male, data=lm1, family="binomial")

#Living in america marginal effect?
i2<- glm(internet_usage ~ continent_america, data=lm1, family = "binomial")
i2e<-  glm(internet_usage ~ continent_europe, data=lm1, family = "binomial")
i2as <- glm(internet_usage ~ continent_asia, data=lm1, family = "binomial")

summary(i1)
summary(i1m)
summary(i2)
summary(i2e)
summary(i2as)


#correlation matrix?

cor<- lm1 %>%
  select(internet_usage, importance_concrete_advice, importance_free, importance_easy_to_access, importance_understandable, importance_engaging, importance_edi, importance_fun, importance_reliable, importance_social_media, importance_evidence_based, importance_unpretentious, importance_other, importance_respectful, importance_unbiased) 

cor<- as.data.frame(lapply(cor, as.numeric))

head(cor)

mat<- cor(cor, method="pearson", use="complete.obs")

res_corr <- as.data.frame(round(mat,2)) #this data frame has a correlation matrix





```




```




